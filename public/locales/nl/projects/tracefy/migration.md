Voor de migratie naar AWS moesten de services overgezet worden. Om dit zo goed mogelijk te voor elkaar te krijgen heb ik meerdere oplossingen ontwikkeld.

Toen ik bij Tracefy kwam werken werden alle berichten opgeslagen in een MySql tabel. MySql kan prima overweg met minder dan 6 miljoen rijen. Daarom hadden we een script die de oudere berichten overzette naar een andere MySql (als een soort van backup). Deze tabel is uitgegroeid naar meer dan 300 miljoen rijen. Om het snel leeg te krijgen heb ik een zelf monitorende pomp ontwikkeld. Deze pomp haalde zo snel mogelijk de berichten uit de database en uploadde deze vervolgens naar een S3 bucket. Als de schijf vol zat, schaalt het script automatisch naar minder download processen en gaat hij juist sneller uploaden. Om het download process zo snel mogelijk te laten verlopen, heb ik de hele database geoptimaliseerd voor lezen en verwijderen van records. De pomp is in Python geschreven. Voor de downloader heb ik PHP moeten gebruiken, omdat de decoder daar in geschreven is. Het uploaden gebeurde met de AWS container van Amazon.

Om dit probleem te voorkomen in de nieuwe omgeving, kwam ik met het idee om de huidige rit logica om te zetten naar DynamoDB. Zo bleef de MySql een stuk kleiner en dus voordeliger. Samen met het team heb ik de rit logica omgezet van PHP naar Go. Hierdoor konden we namelijk zes fysieke machines uitzetten.

Verder hebben we de grote API container opgesplitst in kleine gespecialiseerde services. Op deze manier merkte de eindgebruiker de overschakeling niet en hadden wij alle tijd om rustig te migreren naar de nieuwe database.